<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Beat Stage - K-Pop Rhythm Game</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="ÔøΩÔøΩ Neon Beat Stage - Juego de ritmo K-Pop estilo. ¬°Toca las notas al ritmo de la m√∫sica!">
    <meta name="keywords" content="rhythm game, k-pop, m√∫sica, juego, neon, beat, stage">
    <meta name="author" content="LIPA Studios">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="üéµ Neon Beat Stage - K-Pop Rhythm Game">
    <meta property="og:description" content="¬°Toca las notas al ritmo de la m√∫sica K-Pop! Juego de ritmo adictivo y divertido.">
    <meta property="og:image" content="https://neon-beat-stage.netlify.app/og-image.jpg">
    <meta property="og:url" content="https://neon-beat-stage.netlify.app">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="üéµ Neon Beat Stage - K-Pop Rhythm Game">
    <meta name="twitter:description" content="¬°Toca las notas al ritmo de la m√∫sica K-Pop! Juego de ritmo adictivo y divertido.">
    <meta name="twitter:image" content="https://neon-beat-stage.netlify.app/og-image.jpg">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-633RQLC6T0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-633RQLC6T0');
    </script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4129506161314540" crossorigin="anonymous"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 50%, #0a1a1a 100%);
            color: #fff;
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }
        
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .hidden {
            display: none !important;
        }
        
        .title {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(45deg, #FF0080, #00FFFF, #39FF14);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px rgba(255, 0, 128, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #8A2BE2;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .btn {
            background: linear-gradient(45deg, #FF0080, #00FFFF);
            border: none;
            color: #000;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 0, 128, 0.3);
        }
        
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(255, 0, 128, 0.5);
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        /* GAME AREA */
        .game-area {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 50%, #0a1a1a 100%);
            z-index: 10;
        }
        
        /* LANES */
        .lane {
            position: absolute;
            top: 0;
            width: 25%;
            height: 100%;
            border-right: 2px solid #00FFFF;
        }
        
        .lane:last-child {
            border-right: none;
        }
        
        /* HIT LINE */
        .hit-line {
            position: absolute;
            bottom: 100px;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, #FF0080, #00FFFF, #39FF14, #8A2BE2);
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.8);
            z-index: 1000;
        }
        
        /* NOTES */
        .note {
            position: absolute;
            width: 60px;
            height: 20px;
            background: linear-gradient(45deg, #FF0080, #00FFFF);
            border: 2px solid #FFFF00;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(255,255,0,0.8);
            z-index: 100;
        }
        
        /* TOUCH ZONES */
        .touch-zone {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 25%;
            background: transparent;
            z-index: 50;
            touch-action: manipulation;
        }
        
        .touch-zone[data-lane="0"] { left: 0%; }
        .touch-zone[data-lane="1"] { left: 25%; }
        .touch-zone[data-lane="2"] { left: 50%; }
        .touch-zone[data-lane="3"] { left: 75%; }
        
        .touch-zone.active {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.02);
        }
        
        /* UI ELEMENTS */
        .score-display {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #39FF14;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 1000;
        }
        
        .combo-display {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #FF0080;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 1000;
        }
        
        .lives-display {
            position: fixed;
            top: 60px;
            right: 20px;
            color: #FF6B6B;
            font-size: 1rem;
            font-weight: bold;
            z-index: 1000;
        }
        
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            text-align: center;
            font-size: 0.9rem;
            z-index: 1000;
        }
        
        /* MOBILE OPTIMIZATIONS */
        @media (max-width: 480px) {
            .title {
                font-size: 2rem;
            }
            
            .btn {
                padding: 12px 24px;
                font-size: 1rem;
            }
            
            .hit-line {
                height: 6px;
                bottom: 80px;
            }
            
            .note {
                width: 50px;
                height: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- MENU SCREEN -->
    <div id="menu-screen" class="screen">
        <div class="title">NEON BEAT STAGE</div>
        <div class="subtitle">K-POP RHYTHM GAME</div>
        
        <button class="btn" onclick="startGame()">üéµ START RHYTHM</button>
        <button class="btn" onclick="showTutorial()">üìö TUTORIAL</button>
        <button class="btn" onclick="testAudio()">üîä TEST AUDIO</button>
        
        <div style="margin-top: 30px; text-align: center; color: #39FF14;">
            <div style="font-size: 1rem; margin-bottom: 10px;">üèÜ BEST SCORE</div>
            <div style="font-size: 1.5rem; font-weight: 900;" id="best-score">0</div>
        </div>
        
        <div style="margin-top: 20px; text-align: center; color: #8A2BE2; font-size: 0.8rem;">
            üéÆ by LIPA Studios
        </div>
    </div>
    
    <!-- GAME SCREEN -->
    <div id="game-screen" class="screen hidden">
        <!-- UI ELEMENTS -->
        <div class="score-display">SCORE: <span id="score">0</span></div>
        <div class="combo-display">COMBO: <span id="combo">0</span></div>
        <div class="lives-display">‚ù§Ô∏è <span id="lives">3</span></div>
        
        <!-- GAME AREA -->
        <div class="game-area" id="game-area">
            <!-- LANES -->
            <div class="lane" data-lane="0"></div>
            <div class="lane" data-lane="1"></div>
            <div class="lane" data-lane="2"></div>
            <div class="lane" data-lane="3"></div>
            
            <!-- HIT LINE -->
            <div class="hit-line"></div>
            
            <!-- TOUCH ZONES -->
            <div class="touch-zone" data-lane="0"></div>
            <div class="touch-zone" data-lane="1"></div>
            <div class="touch-zone" data-lane="2"></div>
            <div class="touch-zone" data-lane="3"></div>
        </div>
        
        <!-- INSTRUCTIONS -->
        <div class="instructions">
            üéµ <strong>TAP LANES WHEN NOTES HIT THE LINE</strong> ‚Ä¢ üéØ Perfect = 100pts ‚Ä¢ üé∂ Perfect hits unlock MELODY ‚Ä¢ üé§ Combos add VOCAL!
        </div>
        
        <button class="btn" onclick="showMenu()" style="position: fixed; top: 20px; right: 20px; z-index: 1001; padding: 8px 16px; font-size: 0.8rem;">üè† MENU</button>
    </div>
    
    <script>
        // GAME STATE
        let gameState = {
            score: 0,
            combo: 0,
            lives: 3,
            gameActive: false,
            notes: [],
            noteSpeed: 200,
            beatInterval: 1000,
            lastNoteTime: 0,
            startTime: 0
        };
        
        let gameLoop;
        let currentScreen = 'menu';
        
        // INITIALIZE GAME
        function initGame() {
            console.log('üéµ INIT GAME CALLED');
            setupControls();
            loadBestScore();
        }
        
        // START GAME
        function startGame() {
            console.log('üéµ START GAME CALLED');
            
            // Reset game state
            gameState = {
                score: 0,
                combo: 0,
                lives: 3,
                gameActive: true,
                notes: [],
                noteSpeed: 200,
                beatInterval: 1000,
                lastNoteTime: 0,
                startTime: Date.now()
            };
            
            console.log('üéµ Game state reset:', gameState);
            
            // Show game screen
            console.log('üéµ Hiding menu screen...');
            document.getElementById('menu-screen').classList.add('hidden');
            console.log('üéµ Showing game screen...');
            document.getElementById('game-screen').classList.remove('hidden');
            currentScreen = 'game';
            console.log('üéµ Current screen set to:', currentScreen);
            
            // Update UI
            updateUI();
            
            // Start game loop
            console.log('üéµ Starting game loop...');
            startGameLoop();
            
            console.log('üéµ Game started successfully!');
        }
        
        // START GAME LOOP
        function startGameLoop() {
            console.log('üéµ START GAME LOOP CALLED');
            
            function gameLoopFrame() {
                if (!gameState.gameActive) {
                    console.log('üéµ Game not active, stopping loop');
                    return;
                }
                
                updateGame();
                gameLoop = requestAnimationFrame(gameLoopFrame);
            }
            
            gameLoopFrame();
        }
        
        // UPDATE GAME
        function updateGame() {
            if (!gameState.gameActive) return;
            
            const currentTime = Date.now();
            
            // Spawn notes based on BPM
            if (currentTime - gameState.lastNoteTime > gameState.beatInterval) {
                spawnNote();
                gameState.lastNoteTime = currentTime;
            }
            
            // Move notes
            moveNotes();
            
            // Update UI
            updateUI();
        }
        
        // SPAWN NOTE
        function spawnNote() {
            console.log('üéµ SPAWN NOTE CALLED');
            
            const lanes = 4;
            const lane = Math.floor(Math.random() * lanes);
            const gameArea = document.getElementById('game-area');
            
            const note = document.createElement('div');
            note.className = 'note';
            note.style.cssText = `
                position: absolute;
                width: 60px;
                height: 20px;
                background: linear-gradient(45deg, #FF0080, #00FFFF);
                border: 2px solid #FFFF00;
                border-radius: 10px;
                box-shadow: 0 0 15px rgba(255,255,0,0.8);
                left: ${lane * 25}%;
                top: 0;
                transform: translateX(-50%);
                z-index: 100;
            `;
            
            gameArea.appendChild(note);
            
            gameState.notes.push({
                element: note,
                lane: lane,
                y: 0,
                speed: gameState.noteSpeed,
                active: true
            });
            
            console.log('üéµ Note spawned, total notes:', gameState.notes.length);
        }
        
        // MOVE NOTES
        function moveNotes() {
            if (gameState.notes.length > 0) {
                console.log('üéµ MOVE NOTES CALLED - notes count:', gameState.notes.length);
            }
            
            const gameArea = document.getElementById('game-area');
            const gameAreaHeight = gameArea.offsetHeight;
            const speed = gameState.noteSpeed / 60; // pixels per frame (60fps)
            
            gameState.notes = gameState.notes.filter(note => {
                note.y += speed;
                
                if (note.element && note.element.parentNode) {
                    note.element.style.top = note.y + 'px';
                }
                
                // Remove notes that have passed the bottom
                if (note.y > gameAreaHeight) {
                    if (note.element && note.element.parentNode) {
                        note.element.remove();
                    }
                    return false;
                }
                
                return true;
            });
        }
        
        // SETUP CONTROLS
        function setupControls() {
            console.log('üéµ SETUP CONTROLS CALLED');
            
            const touchZones = document.querySelectorAll('.touch-zone');
            
            touchZones.forEach((zone, index) => {
                zone.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (gameState.gameActive) {
                        const lane = parseInt(zone.dataset.lane);
                        zone.classList.add('active');
                        
                        console.log(`üéµ TOUCH detected on lane ${lane}`);
                        handleInput(lane);
                        
                        // Haptic feedback
                        if (navigator.vibrate) {
                            navigator.vibrate(30);
                        }
                    }
                }, { passive: false });
                
                zone.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    zone.classList.remove('active');
                }, { passive: false });
                
                // Mouse support for desktop
                zone.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    
                    if (gameState.gameActive) {
                        const lane = parseInt(zone.dataset.lane);
                        zone.classList.add('active');
                        
                        console.log(`üéµ MOUSE detected on lane ${lane}`);
                        handleInput(lane);
                    }
                });
                
                zone.addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    zone.classList.remove('active');
                });
            });
        }
        
        // HANDLE INPUT
        function handleInput(lane) {
            console.log(`üéµ HANDLE INPUT CALLED for lane ${lane}`);
            
            const hitLineY = document.querySelector('.hit-line').offsetTop;
            let closestNote = null;
            let closestDistance = Infinity;
            
            // Find closest note in this lane
            gameState.notes.forEach(note => {
                if (note.lane === lane && note.active) {
                    const distance = Math.abs(note.y - hitLineY);
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        closestNote = note;
                    }
                }
            });
            
            // Check if hit is close enough
            if (closestNote && closestDistance < 50) {
                console.log('üéµ HIT! Distance:', closestDistance);
                handleHit(lane, closestNote);
            } else {
                console.log('üéµ MISS! Distance:', closestDistance);
                handleMiss(lane);
            }
        }
        
        // HANDLE HIT
        function handleHit(lane, note) {
            console.log('üéµ HANDLE HIT CALLED');
            
            // Remove note
            if (note.element && note.element.parentNode) {
                note.element.remove();
            }
            note.active = false;
            
            // Update score
            gameState.score += 100;
            gameState.combo++;
            
            // Update UI
            updateUI();
            
            console.log('üéµ Hit! Score:', gameState.score, 'Combo:', gameState.combo);
        }
        
        // HANDLE MISS
        function handleMiss(lane) {
            console.log('üéµ HANDLE MISS CALLED');
            
            gameState.combo = 0;
            gameState.lives--;
            
            // Update UI
            updateUI();
            
            // Check game over
            if (gameState.lives <= 0) {
                gameOver();
            }
            
            console.log('üéµ Miss! Lives:', gameState.lives);
        }
        
        // UPDATE UI
        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('combo').textContent = gameState.combo;
            document.getElementById('lives').textContent = gameState.lives;
        }
        
        // GAME OVER
        function gameOver() {
            console.log('üéµ GAME OVER CALLED');
            
            gameState.gameActive = false;
            
            if (gameLoop) {
                cancelAnimationFrame(gameLoop);
                gameLoop = null;
            }
            
            // Show game over modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(45deg, #FF0080, #00FFFF); padding: 30px; border-radius: 20px; text-align: center; color: #000;">
                    <h2 style="margin-bottom: 20px;">üéµ GAME OVER! üéµ</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 20px;">Score: ${gameState.score}</p>
                    <p style="font-size: 1.2rem; margin-bottom: 20px;">Combo: ${gameState.combo}</p>
                    <button onclick="restartGame(); this.closest('div').parentNode.remove()" style="background: #8A2BE2; color: #fff; border: none; padding: 12px 25px; margin: 8px; border-radius: 8px; font-weight: bold; cursor: pointer;">üéÆ RESTART</button>
                    <button onclick="showMenu(); this.closest('div').parentNode.remove()" style="background: #666; color: #fff; border: none; padding: 12px 25px; margin: 8px; border-radius: 8px; font-weight: bold; cursor: pointer;">üè† MENU</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // RESTART GAME
        function restartGame() {
            console.log('üéµ RESTART GAME CALLED');
            startGame();
        }
        
        // SHOW MENU
        function showMenu() {
            console.log('üéµ SHOW MENU CALLED');
            
            currentScreen = 'menu';
            gameState.gameActive = false;
            
            if (gameLoop) {
                cancelAnimationFrame(gameLoop);
                gameLoop = null;
            }
            
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('menu-screen').classList.remove('hidden');
            
            // Update best score
            if (gameState.score > gameState.bestScore) {
                gameState.bestScore = gameState.score;
                localStorage.setItem('neonBeatBestScore', gameState.bestScore);
            }
            
            document.getElementById('best-score').textContent = gameState.bestScore || 0;
        }
        
        // LOAD BEST SCORE
        function loadBestScore() {
            const bestScore = localStorage.getItem('neonBeatBestScore') || 0;
            gameState.bestScore = parseInt(bestScore);
            document.getElementById('best-score').textContent = bestScore;
        }
        
        // TUTORIAL
        function showTutorial() {
            alert('üéµ TUTORIAL:\n\n1. Toca las notas cuando lleguen a la l√≠nea de hit\n2. Perfect hits = 100 puntos\n3. Combos aumentan tu puntuaci√≥n\n4. Tienes 3 vidas\n5. ¬°Divi√©rtete!');
        }
        
        // TEST AUDIO
        function testAudio() {
            alert('üîä Audio test - Si puedes escuchar esto, el audio funciona correctamente!');
        }
        
        // INITIALIZE ON LOAD
        window.addEventListener('load', () => {
            console.log('üéµ PAGE LOADED - Initializing game...');
            initGame();
        });
    </script>
</body>
</html>
