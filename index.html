<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Beat Stage - K-pop Rhythm Game</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(145deg, #0a0a0a, #1a1a2e); color: white; overflow: hidden; height: 100vh; user-select: none; }
        .game-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background: rgba(0,0,0,0.8); border-bottom: 2px solid #FF0080; }
        .score { color: #FFFF00; font-weight: bold; font-size: 18px; }
        .lives { color: #FF4444; font-weight: bold; font-size: 18px; }
        .combo { color: #00FFFF; font-weight: bold; font-size: 18px; }
        .game-area { width: 100%; height: calc(100vh - 80px); position: relative; display: flex; background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%); }
        .lane { width: 25%; height: 100%; border-left: 1px solid #00FFFF; position: relative; cursor: pointer; }
        .lane:last-child { border-right: 1px solid #00FFFF; }
        .hit-line { position: absolute; bottom: 80px; left: 0; right: 0; height: 6px; background: linear-gradient(90deg, #FF0080, #00FFFF, #FFFF00, #FF0080); box-shadow: 0 0 20px #FF0080; z-index: 10; }
        .note { position: absolute; width: 20%; height: 40px; left: 2.5%; background: linear-gradient(45deg, #FF0080, #00FFFF); border-radius: 8px; box-shadow: 0 0 15px #FF0080; border: 2px solid #FFFFFF; z-index: 5; }
        .touch-zone { position: absolute; bottom: 0; width: 100%; height: 160px; background: rgba(0,255,255,0.1); z-index: 20; }
    </style>
</head>
<body>
    <div class="game-header">
        <div class="score" id="score">SCORE: 0</div>
        <div class="lives" id="lives">‚ù§Ô∏è 3</div>
        <div class="combo" id="combo">COMBO: 0</div>
    </div>
    <div class="game-area" id="gameArea">
        <div class="lane" data-lane="0"><div class="touch-zone" data-lane="0"></div></div>
        <div class="lane" data-lane="1"><div class="touch-zone" data-lane="1"></div></div>
        <div class="lane" data-lane="2"><div class="touch-zone" data-lane="2"></div></div>
        <div class="lane" data-lane="3"><div class="touch-zone" data-lane="3"></div></div>
        <div class="hit-line"></div>
    </div>
    <script>
        let gameState = { score: 0, combo: 0, lives: 3, notes: [], gameActive: true, frameCount: 0 };
        let audioContext = null;
        let backgroundMusic = null;

        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log("üéµ Audio initialized");
            } catch (e) {
                console.log("Audio not supported");
            }
        }

        function playSound(frequency, duration, type = "sine", volume = 0.3) {
            if (!audioContext) return;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = type;
            gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function startKPopBeat() {
            if (!audioContext) return;
            let beatCount = 0;
            const kpopFreqs = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
            backgroundMusic = setInterval(() => {
                if (gameState.gameActive) {
                    playSound(130.81, 0.1, "sawtooth", 0.15); // Bass drum
                    if (beatCount % 2 === 0) {
                        playSound(kpopFreqs[beatCount % 4], 0.2, "sine", 0.1);
                    }
                    beatCount++;
                }
            }, 500);
        }        
        function startGame() {
            console.log('üéÆ STARTING NEON BEAT STAGE');
            gameState.gameActive = true;
            gameState.frameCount = 0;
            updateUI();
            gameLoop();
            setupControls();
            initAudio();
            startKPopBeat();
            console.log('‚úÖ Game started successfully');
        }
        
        function gameLoop() {
            if (!gameState.gameActive) return;
            gameState.frameCount++;
            if (gameState.frameCount >= 48) {
                spawnNote();
                gameState.frameCount = 0;
            }
            moveNotes();
            requestAnimationFrame(gameLoop);
        }
        
        function spawnNote() {
            const lane = Math.floor(Math.random() * 4);
            const gameArea = document.getElementById('gameArea');
            const note = document.createElement('div');
            note.className = 'note';
            note.style.left = (lane * 25 + 2.5) + '%';
            note.style.top = '0px';
            note.dataset.lane = lane;
            gameArea.appendChild(note);
            gameState.notes.push({ element: note, lane: lane, y: 0 });
            console.log(`üéµ Note spawned in lane ${lane}. Total notes: ${gameState.notes.length}`);
        }
        
        function moveNotes() {
            gameState.notes.forEach((note, index) => {
                note.y += 4;
                note.element.style.top = note.y + 'px';
                if (note.y > window.innerHeight) {
                    note.element.remove();
                    gameState.notes.splice(index, 1);
                    gameState.lives--;
                    gameState.combo = 0;
                    updateUI();
                    if (gameState.lives <= 0) gameOver();
                }
            });
        }
        
        function handleInput(lane) {
            if (!gameState.gameActive) return;
            console.log(`üëÜ Input detected on lane ${lane}`);
            const hitLineY = window.innerHeight - 160;
            let hitNote = null;
            let bestDistance = Infinity;
            gameState.notes.forEach((note, index) => {
                if (note.lane === lane) {
                    const distance = Math.abs(note.y - hitLineY);
                    if (distance < 50 && distance < bestDistance) {
                        hitNote = { note, index };
                        bestDistance = distance;
                    }
                }
            });
            if (hitNote) {
                hitNote.note.element.remove();
                gameState.notes.splice(hitNote.index, 1);
                gameState.score += 100;
                gameState.combo++;
                console.log(`‚úÖ HIT! Score: ${gameState.score}, Combo: ${gameState.combo}`);
                showHitEffect(lane);
                playSound(523.25 + lane * 100, 0.3, "sine", 0.2);
            } else {
                gameState.combo = 0;
                console.log(`‚ùå MISS on lane ${lane}`);
            }
            updateUI();
        }
        
        function showHitEffect(lane) {
            const laneElement = document.querySelector(`[data-lane="${lane}"]`);
            laneElement.style.background = 'rgba(255,255,255,0.3)';
            setTimeout(() => { laneElement.style.background = ''; }, 150);
        }
        
        function setupControls() {
            const touchZones = document.querySelectorAll('.touch-zone');
            touchZones.forEach((zone) => {
                const lane = parseInt(zone.dataset.lane);
                zone.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(lane); }, { passive: false });
                zone.addEventListener('click', (e) => { e.preventDefault(); handleInput(lane); });
            });
            console.log('‚úÖ Touch controls setup complete');
        }
        
        function updateUI() {
            document.getElementById('score').textContent = `SCORE: ${gameState.score}`;
            document.getElementById('lives').textContent = `‚ù§Ô∏è ${gameState.lives}`;
            document.getElementById('combo').textContent = `COMBO: ${gameState.combo}`;
        }
        
        function gameOver() {
            gameState.gameActive = false;
            console.log("üíÄ GAME OVER");
            showViralGameOverScreen();
        }

        function showViralGameOverScreen() {
            const modal = document.createElement("div");
            modal.style.cssText = "position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 1000;";
            modal.innerHTML = `<div style="background: linear-gradient(145deg, #1a1a2e, #16213e); padding: 30px; border-radius: 20px; text-align: center; border: 3px solid #00FFFF; box-shadow: 0 0 30px #FF0080; max-width: 90%;"><h2 style="color: #FF0080; margin: 20px 0;">üéÆ GAME OVER! üéÆ</h2><div style="margin: 20px 0; color: white;"><p>üéØ Score: ${gameState.score}</p><p>üî• Max Combo: ${gameState.combo}</p><p>‚ú® Notes Hit: ${Math.floor(gameState.score / 100)}</p></div><button onclick="shareNeonBeat()" style="width:100%; margin:10px 0; padding:15px; background: linear-gradient(45deg, #FF0080, #00FFFF); border:none; color:white; font-weight:bold; border-radius:10px; cursor:pointer; font-size:16px;">üì± SHARE SCORE</button><button onclick="copyNeonBeatMessage()" style="width:100%; margin:10px 0; padding:15px; background: linear-gradient(45deg, #FFFF00, #FF0080); border:none; color:white; font-weight:bold; border-radius:10px; cursor:pointer; font-size:16px;">üìã COPY MESSAGE</button><button onclick="watchAdToContinue(event)" style="width:100%; margin:10px 0; padding:15px; background: linear-gradient(45deg, #FF6600, #FFFF00); border:none; color:white; font-weight:bold; border-radius:10px; cursor:pointer; font-size:16px;">üé¨ WATCH AD TO CONTINUE</button><button onclick="location.reload()" style="width:100%; margin:10px 0; padding:15px; background: linear-gradient(45deg, #8A2BE2, #00FFFF); border:none; color:white; font-weight:bold; border-radius:10px; cursor:pointer; font-size:16px;">üîÑ NEW GAME</button></div>`;
            document.body.appendChild(modal);
        }

        function shareNeonBeat() {
            const shareText = `üéµ ¬°Consegu√≠ ${gameState.score} puntos en Neon Beat Stage! üéµ\n\nüî• Max Combo: ${gameState.combo}x\n‚ú® Notes Hit: ${Math.floor(gameState.score / 100)}\nüéÆ ¬øPuedes superarme?\n\nhttps://neon-beat-stage.netlify.app`;
            if (navigator.share) {
                navigator.share({ title: "Neon Beat Stage - K-pop Rhythm Game", text: shareText, url: "https://neon-beat-stage.netlify.app" });
            } else {
                copyNeonBeatMessage();
            }
        }

        function copyNeonBeatMessage() {
            const viralText = `üéµ ¬°Consegu√≠ ${gameState.score} puntos en Neon Beat Stage! üéµ\n\nüî• Max Combo: ${gameState.combo}x\n‚ú® Perfect Hits: ${Math.floor(gameState.score / 100)}\nüéÆ ¬øPuedes superarme?\n\nJuega aqu√≠: https://neon-beat-stage.netlify.app\n\n#NeonBeatStage #KpopRhythm #CyberpunkGame`;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(viralText).then(() => {
                    showNotification("üìã ¬°Mensaje copiado! P√©galo en tus redes sociales üöÄ");
                });
            } else {
                alert("üìã " + viralText);
            }
        }

        function watchAdToContinue(event) {
            const button = event.target;
            button.textContent = "‚è≥ LOADING AD...";
            button.disabled = true;
            setTimeout(() => {
                button.textContent = "üé¨ AD PLAYING...";
                setTimeout(() => {
                    gameState.lives = 2;
                    gameState.gameActive = true;
                    gameState.notes.forEach(note => {
                        if (note.element && note.element.parentNode) {
                            note.element.parentNode.removeChild(note.element);
                        }
                    });
                    gameState.notes = [];
                    gameState.frameCount = 0;
                    updateUI();
                    document.querySelector(`[style*="position: fixed"]`).remove();
                    showNotification("üé¨ AD REWARD: +2 LIVES! ‚ù§Ô∏è");
                    gameLoop();
                }, 3000);
            }, 1000);
        }

        function showNotification(message) {
            const notification = document.createElement("div");
            notification.style.cssText = "position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: linear-gradient(45deg, #FF0080, #00FFFF); color: white; padding: 15px 25px; border-radius: 25px; font-weight: bold; z-index: 10000; box-shadow: 0 0 20px #FF0080;";
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => { notification.remove(); }, 3000);
        }        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ DOM loaded - Starting game...');
            startGame();
        });
    </script>
</body>
</html>
